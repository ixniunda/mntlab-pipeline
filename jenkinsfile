node {
    def mvnHome = tool 'gradle3.3'
    stage('Preparation') {
// Get some code from a GitHub repository
        checkout([$class: 'GitSCM', branches: [[name: 'kkaliada']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[url: 'https://github.com/MNT-Lab/mntlab-pipeline.git']]])
    }
    stage('Build') {
        sh "'${mvnHome}/bin/gradle' build"
    }
    stage('Testt')
            {
                parallel (
                        "Cucumber Test":
                                {
                                    sh "'${mvnHome}/bin/gradle' cucumber"

                                },
                        "JUnit Test" :
                                {

                            sh "'${mvnHome}/bin/gradle' test"

                                },
                        "Jacoco Test" :
                                {
                                    sh "'${mvnHome}/bin/gradle' jacocoTestReport"
                                })
            }
    stage('Triggering job and fetching artefact after finishing') {
        build job: 'MNTLAB-kkaliada-child1-build-job', parameters: [string( name: 'BRANCH_NAME', value: 'kkaliada')]
        copyArtifacts(projectName: 'MNTLAB-kkaliada-child1-build-job', filter: 'kkaliada_dsl_script.tar.gz')
    }
    stage('Packaging and Publishing results')
            {
                sh"tar -xvf kkaliada_dsl_script.tar.gz"
                sh"tar -cvzf pipeline-kkaliada-'$BUILD_NUMBER'.tar.gz dsl_jobs.groovy jenkinsfile build/libs/gradle-simple.jar"
            }
}	
    stage('Asking for manual approval'){
        input "Deploy to prod?"}}		
